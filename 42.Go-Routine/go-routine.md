# ЁЯЪА Golang Goroutine - рж╕ржорзНржкрзВрж░рзНржг ржмрж╛ржВрж▓рж╛ ржЧрж╛ржЗржб

## ЁЯУЪ рж╕рзВржЪрж┐ржкрждрзНрж░
1. [Goroutine ржХрзА?](#goroutine-ржХрзА)
2. [Memory Layout ржмрзБржЭрзБржи](#memory-layout-ржмрзБржЭрзБржи)
3. [2KB Stack ржПрж░ рж░рж╣рж╕рзНржп](#2kb-stack-ржПрж░-рж░рж╣рж╕рзНржп)
4. [ржХрзЛржб ржЙржжрж╛рж╣рж░ржг ржмрзНржпрж╛ржЦрзНржпрж╛](#ржХрзЛржб-ржЙржжрж╛рж╣рж░ржг-ржмрзНржпрж╛ржЦрзНржпрж╛)
5. [Go Runtime ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ](#go-runtime-ржХрзАржнрж╛ржмрзЗ-ржХрж╛ржЬ-ржХрж░рзЗ)
6. [OS Thread vs Goroutine](#os-thread-vs-goroutine)
7. [ржмрж╛рж╕рзНрждржм ржЬрзАржмржирзЗрж░ ржЙржжрж╛рж╣рж░ржг](#ржмрж╛рж╕рзНрждржм-ржЬрзАржмржирзЗрж░-ржЙржжрж╛рж╣рж░ржг)

---

## ЁЯОп Goroutine ржХрзА?

### рж╕рж╣ржЬ ржнрж╛рж╖рж╛ржпрж╝:
**Goroutine** рж╣рж▓рзЛ Go programming language ржПрж░ ржПржХржЯрж┐ ржЕрждрж┐ рж╣рж╛рж▓ржХрж╛ ржерзНрж░рзЗржб (thread)ред ржПржХрзЗ **"logical processor"** ржмрж╛ **"virtual thread"** ржмрж▓рж╛ рж╣ржпрж╝ред

### ржЖрж░рзЛ рж╕рж╣ржЬ ржХрж░рзЗ:
ржзрж░рзБржи ржЖржкржирж╛рж░ ржПржХржЯрж╛ рж░рзЗрж╕рзНрждрзЛрж░рж╛ржБ ржЖржЫрзЗред рж╕рзЗржЦрж╛ржирзЗ:
- **OS Thread** = ржПржХржЬржи ржкрж╛ржХрж╛ рж░рж╛ржБржзрзБржирж┐ (ржмрзЗрждржи ржмрзЗрж╢рж┐, ржЬрж╛ржпрж╝ржЧрж╛ ржмрзЗрж╢рж┐ ржирзЗржпрж╝)
- **Goroutine** = ржПржХржЬржи ржжржХрзНрж╖ рж╕рж╣ржХрж╛рж░рзА (ржХржо ржмрзЗрждржи, ржХржо ржЬрж╛ржпрж╝ржЧрж╛, ржХрж┐ржирзНрждрзБ ржжрзНрж░рзБржд ржХрж╛ржЬ ржХрж░рзЗ)

ржЖржкржирж┐ 10 ржЬржи рж░рж╛ржБржзрзБржирж┐ рж░рж╛ржЦрждрзЗ ржкрж╛рж░ржмрзЗржи, ржХрж┐ржирзНрждрзБ 1000 ржЬржи рж╕рж╣ржХрж╛рж░рзА рж░рж╛ржЦрждрзЗ ржкрж╛рж░ржмрзЗржи!

### ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:
- тЬЕ ржЕрждрж┐ рж╣рж╛рж▓ржХрж╛ (рж╢рзБрж░рзБрждрзЗ ржорж╛рждрзНрж░ 2KB memory ржирзЗржпрж╝)
- тЬЕ ржжрзНрж░рзБржд рждрзИрж░рж┐ ржПржмржВ destroy рж╣ржпрж╝
- тЬЕ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ goroutine ржПржХрж╕рж╛ржерзЗ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржпрж╝
- тЬЕ Go Runtime ржирж┐ржЬрзЗржЗ manage ржХрж░рзЗ

---

## ЁЯТ╛ Memory Layout ржмрзБржЭрзБржи

### RAM ржПрж░ ржЪрж╛рж░ржЯрж┐ ржкрзНрж░ржзрж╛ржи ржЕржВрж╢:

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  1. Code Segment (ржХрзЛржб рж╕рзЗржЧржорзЗржирзНржЯ)        тФВ  тЖР ржЖржкржирж╛рж░ рж▓рзЗржЦрж╛ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржерж╛ржХрзЗ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  2. Data Segment (ржбрзЗржЯрж╛ рж╕рзЗржЧржорзЗржирзНржЯ)       тФВ  тЖР Global variable ржерж╛ржХрзЗ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  3. Stack (рж╕рзНржЯрзНржпрж╛ржХ)                     тФВ  тЖР Function call, local variable
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ  4. Heap (рж╣рж┐ржк)                          тФВ  тЖР Dynamic memory allocation
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рзз. Code Segment (ржХрзЛржб рж╕рзЗржЧржорзЗржирзНржЯ):
- ржЖржкржирж╛рж░ рж▓рзЗржЦрж╛ `main()`, `printHello()`, `addCalc()` function ржерж╛ржХрзЗ
- Read-only (рж╢рзБржзрзБ ржкржбрж╝рж╛ ржпрж╛ржпрж╝, ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ ржпрж╛ржпрж╝ ржирж╛)

### рзи. Data Segment (ржбрзЗржЯрж╛ рж╕рзЗржЧржорзЗржирзНржЯ):
- Global variable ржПржмржВ static variable ржерж╛ржХрзЗ
- ржЙржжрж╛рж╣рж░ржг: `var globalCounter int = 0`

### рзй. Stack (рж╕рзНржЯрзНржпрж╛ржХ):
- Function call ржХрж░рж▓рзЗ ржПржЦрж╛ржирзЗ ржЬрж╛ржпрж╝ржЧрж╛ ржирзЗржпрж╝
- Local variable рж░рж╛ржЦрзЗ
- ржкрзНрж░рждрж┐ржЯрж┐ goroutine ржПрж░ ржЖрж▓рж╛ржжрж╛ stack ржЖржЫрзЗ

### рзк. Heap (рж╣рж┐ржк):
- Dynamic memory allocation рж╣ржпрж╝
- **Goroutine ржПрж░ stack ржПржЦрж╛ржирзЗржЗ ржерж╛ржХрзЗ!** (ржПржЯрж╛ржЗ ржмрж┐рж╢рзЗрж╖рждрзНржм)
- Garbage Collector ржПржЦрж╛ржирзЗ ржХрж╛ржЬ ржХрж░рзЗ

---

## ЁЯФ┤ 2KB Stack ржПрж░ рж░рж╣рж╕рзНржп

### Traditional OS Thread:
```
OS Thread рждрзИрж░рж┐ рж╣рж▓рзЗ:
тФФтФАтЖТ Stack: 1-2 MB (ржкрзНрж░ржержо ржерзЗржХрзЗржЗ ржмржбрж╝)
    тФФтФАтЖТ RAM ржПрж░ ржЕржирзЗржХ ржЬрж╛ржпрж╝ржЧрж╛ ржирзЗржпрж╝
    тФФтФАтЖТ ржмрзЗрж╢рж┐ thread ржЪрж╛рж▓рж╛ржирзЛ ржХржарж┐ржи
```

### Goroutine ржПрж░ рж╕рзНржорж╛рж░рзНржЯ ржкржжрзНржзрждрж┐:
```
Goroutine рждрзИрж░рж┐ рж╣рж▓рзЗ:
тФФтФАтЖТ Heap ржП ржорж╛рждрзНрж░ 2KB stack allocate рж╣ржпрж╝
    тФФтФАтЖТ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣рж▓рзЗ ржмрж╛ржбрж╝рзЗ (grow)
    тФФтФАтЖТ ржХрж╛ржЬ рж╢рзЗрж╖рзЗ ржХржорзЗ (shrink)
    тФФтФАтЖТ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ goroutine ржЪрж╛рж▓рж╛ржирзЛ рж╕рж╣ржЬ!
```

### ржХрзЗржи Heap ржП Stack рж░рж╛ржЦрж╛ рж╣ржпрж╝?

**ржХрж╛рж░ржг:**
1. **Dynamic Size:** ржжрж░ржХрж╛рж░ ржЕржирзБржпрж╛ржпрж╝рзА ржмрж╛ржбрж╝рж╛ржирзЛ-ржХржорж╛ржирзЛ ржпрж╛ржпрж╝
2. **Memory Efficiency:** рж╢рзБрж░рзБрждрзЗ ржХржо memory ржирзЗржпрж╝
3. **Go Runtime Control:** Go ржирж┐ржЬрзЗржЗ manage ржХрж░рждрзЗ ржкрж╛рж░рзЗ
4. **Garbage Collection:** ржЕржмрзНржпржмрж╣рзГржд memory automatic clean рж╣ржпрж╝

### Stack ржХрзАржнрж╛ржмрзЗ Grow ржХрж░рзЗ:

```
ржкрзНрж░ржержо ржЕржмрж╕рзНржерж╛:
Goroutine 1: [2KB] тЖР Heap ржП

ржмрзЗрж╢рж┐ function call рж╣рж▓рзЗ:
Goroutine 1: [2KB тЖТ 4KB тЖТ 8KB] тЖР Automatically ржмрж╛ржбрж╝рзЗ

ржХрж╛ржЬ рж╢рзЗрж╖рзЗ:
Goroutine 1: [8KB тЖТ 4KB тЖТ 2KB] тЖР ржЖржмрж╛рж░ ржХржорзЗ ржпрж╛ржпрж╝
```

---

## ЁЯТ╗ ржХрзЛржб ржЙржжрж╛рж╣рж░ржг ржмрзНржпрж╛ржЦрзНржпрж╛

### ржЖржкржирж╛рж░ ржжрзЗржУржпрж╝рж╛ ржХрзЛржб:

```go
package main

import (
    "fmt"
    "time"
)

func addCalc(a, b int) {
    fmt.Println(a + b)
}

func printHello(num int) {
    fmt.Println("Hello Bappy", num)
    addCalc(10, 20)
}

func main() {
    go printHello(1)  // Goroutine 1
    go printHello(2)  // Goroutine 2
    go printHello(3)  // Goroutine 3
    go printHello(4)  // Goroutine 4
    go printHello(5)  // Goroutine 5

    time.Sleep(4 * time.Second)  // Wait ржХрж░рж╛
}
```

### Step by Step ржХрзА рж╣ржЪрзНржЫрзЗ:

#### ржзрж╛ржк рзз: Program рж╢рзБрж░рзБ
```
main() function ржЪрж╛рж▓рзБ рж╣ржпрж╝
тФФтФАтЖТ Main Goroutine рждрзИрж░рж┐ рж╣ржпрж╝
    тФФтФАтЖТ Heap ржП 2KB stack allocate рж╣ржпрж╝
```

#### ржзрж╛ржк рзи: ржкрзНрж░ржержо `go printHello(1)` execute рж╣ржпрж╝
```
Heap ржП ржирждрзБржи 2KB stack рждрзИрж░рж┐:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ Goroutine 1      тФВ
тФВ Stack: 2KB       тФВ
тФВ тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ тФВ num = 1      тФВ тФВ тЖР printHello ржПрж░ parameter
тФВ тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

ржПржЗ goroutine background ржП ржЪрж▓рждрзЗ ржерж╛ржХрзЗ!
```

#### ржзрж╛ржк рзй: рж╕ржм goroutine ржПржХрж╕рж╛ржерзЗ рждрзИрж░рж┐ рж╣ржпрж╝
```
Heap Memory:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ Goroutine 1 тФВ Goroutine 2 тФВ Goroutine 3 тФВ Goroutine 4 тФВ Goroutine 5 тФВ
тФВ Stack: 2KB  тФВ Stack: 2KB  тФВ Stack: 2KB  тФВ Stack: 2KB  тФВ Stack: 2KB  тФВ
тФВ num = 1     тФВ num = 2     тФВ num = 3     тФВ num = 4     тФВ num = 5     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Total: 5 ├Ч 2KB = 10KB memory (ржЦрзБржмржЗ ржХржо!)
```

#### ржзрж╛ржк рзк: ржкрзНрж░рждрж┐ржЯрж┐ goroutine ржХрж╛ржЬ ржХрж░рзЗ
```
Goroutine 1 ржП:
printHello(1) ржЪрж▓ржЫрзЗ
тФФтФАтЖТ Stack ржП: num = 1
    тФФтФАтЖТ addCalc(10, 20) call рж╣рж▓рзЛ
        тФФтФАтЖТ Stack ржП: a = 10, b = 20
            тФФтФАтЖТ Print: 30
        тФФтФАтЖТ Stack ржерзЗржХрзЗ addCalc рж╕рж░рзЗ ржЧрзЗрж▓
    тФФтФАтЖТ Print: "Hello Bappy 1"
тФФтФАтЖТ Goroutine 1 рж╢рзЗрж╖, stack free рж╣ржпрж╝рзЗ ржЧрзЗрж▓

ржПржХржЗржнрж╛ржмрзЗ рж╕ржм goroutine ржЪрж▓ржЫрзЗ!
```

#### ржзрж╛ржк рзл: Main Goroutine ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржЫрзЗ
```
time.Sleep(4 * time.Second)
тФФтФАтЖТ Main goroutine 4 second ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржмрзЗ
    тФФтФАтЖТ ржПржЗ рж╕ржоржпрж╝рзЗ ржЕржирзНржп goroutine ржЧрзБрж▓рзЛ ржХрж╛ржЬ рж╢рзЗрж╖ ржХрж░ржмрзЗ
    тФФтФАтЖТ ржирж╛ рж╣рж▓рзЗ program рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ рж╢рзЗрж╖ рж╣ржпрж╝рзЗ ржпрзЗржд!
```

### рж╕ржорзНржнрж╛ржмрзНржп Output:
```
Hello Bappy 3
30
Hello Bappy 1
30
Hello Bappy 5
30
Hello Bappy 2
30
Hello Bappy 4
30
```

**ржоржирзЗ рж░рж╛ржЦрзБржи:** Output ржПрж░ order ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖрж▓рж╛ржжрж╛ рж╣рждрзЗ ржкрж╛рж░рзЗ! ржХрж╛рж░ржг goroutine ржЧрзБрж▓рзЛ ржПржХрж╕рж╛ржерзЗ (concurrently) ржЪрж▓ржЫрзЗред

---

## тЪЩя╕П Go Runtime ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ

### Go Runtime ржХрзА?
Go Runtime рж╣рж▓рзЛ ржПржХржЯрж╛ **"mini operating system"** ржпрж╛ ржЖржкржирж╛рж░ program ржПрж░ ржнрж┐рждрж░рзЗржЗ ржерж╛ржХрзЗред

### Go Runtime ржПрж░ ржЪрж╛рж░ржЯрж┐ ржкрзНрж░ржзрж╛ржи ржХрж╛ржЬ:

#### рзз. Go Routine Scheduler (ржЧрзЛ рж░рзБржЯрж┐ржи рж╢рж┐ржбрж┐ржЙрж▓рж╛рж░):
```
ржХрж╛ржЬ: ржХрзЛржи goroutine ржХржЦржи ржЪрж▓ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛

ржЙржжрж╛рж╣рж░ржг:
CPU Core 1: Goroutine 1 тЖТ Goroutine 3 тЖТ Goroutine 5
CPU Core 2: Goroutine 2 тЖТ Goroutine 4
```

#### рзи. Heap Allocator (рж╣рж┐ржк ржЕрзНржпрж╛рж▓рзЛржХрзЗржЯрж░):
```
ржХрж╛ржЬ: Goroutine ржПрж░ ржЬржирзНржп memory ржмрж░рж╛ржжрзНржж ржХрж░рж╛

Goroutine рждрзИрж░рж┐:
тФФтФАтЖТ Heap ржП 2KB ржЬрж╛ржпрж╝ржЧрж╛ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж╛
    тФФтФАтЖТ Stack рждрзИрж░рж┐ ржХрж░рж╛
    тФФтФАтЖТ Goroutine ржЪрж╛рж▓рзБ ржХрж░рж╛
```

#### рзй. Garbage Collector (ржЧрж╛рж░рзНржмрзЗржЬ ржХрж╛рж▓рзЗржХрзНржЯрж░):
```
ржХрж╛ржЬ: ржЕржмрзНржпржмрж╣рзГржд memory clean ржХрж░рж╛

Goroutine рж╢рзЗрж╖ рж╣рж▓рзЗ:
тФФтФАтЖТ Stack ржПрж░ memory check ржХрж░рж╛
    тФФтФАтЖТ ржХрзЗржЙ use ржХрж░ржЫрзЗ ржирж╛?
    тФФтФАтЖТ Memory free ржХрж░рзЗ ржжрж╛ржУ!
```

#### рзк. Logical Processors Management:
```
ржХрж╛ржЬ: ржХржпрж╝ржЯрж╛ OS thread ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг

Default: CPU core рж╕ржВржЦрзНржпрж╛ ржЕржирзБржпрж╛ржпрж╝рзА
4 Core CPU = 4 logical processors
8 Core CPU = 8 logical processors

ржПржЗ logical processor ржЧрзБрж▓рзЛржЗ goroutine ржЪрж╛рж▓рж╛ржпрж╝!
```

### ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо ржПржХ ржиржЬрж░рзЗ:

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              Your Go Program                    тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР   тФВ
тФВ  тФВ        Go Runtime (mini OS)             тФВ   тФВ
тФВ  тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФВ   тФВ
тФВ  тФВ  тФВ   Scheduler                     тФВ    тФВ   тФВ
тФВ  тФВ  тФВ   тАв Goroutine 1 тЖТ CPU Core 1   тФВ    тФВ   тФВ
тФВ  тФВ  тФВ   тАв Goroutine 2 тЖТ CPU Core 2   тФВ    тФВ   тФВ
тФВ  тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФВ   тФВ
тФВ  тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФВ   тФВ
тФВ  тФВ  тФВ   Heap Allocator                тФВ    тФВ   тФВ
тФВ  тФВ  тФВ   тАв 2KB for Goroutine 1        тФВ    тФВ   тФВ
тФВ  тФВ  тФВ   тАв 2KB for Goroutine 2        тФВ    тФВ   тФВ
тФВ  тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФВ   тФВ
тФВ  тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФВ   тФВ
тФВ  тФВ  тФВ   Garbage Collector             тФВ    тФВ   тФВ
тФВ  тФВ  тФВ   тАв Clean unused memory         тФВ    тФВ   тФВ
тФВ  тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФВ   тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тЖУ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ           Operating System                       тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ  тФВ OS ThreadтФВ OS ThreadтФВ OS ThreadтФВ OS ThreadтФВ тФВ
тФВ  тФВ    1     тФВ    2     тФВ    3     тФВ    4     тФВ тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тЖУ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              CPU Hardware                        тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР тФВ
тФВ  тФВ  Core 1  тФВ  Core 2  тФВ  Core 3  тФВ  Core 4  тФВ тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯЖЪ OS Thread vs Goroutine

### ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждрзБрж▓ржирж╛:

| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп | OS Thread | Goroutine |
|-----------|-----------|-----------|
| **ржкрзНрж░рж╛ржержорж┐ржХ Stack Size** | 1-2 MB (ржмржбрж╝) | 2 KB (ржЦрзБржм ржЫрзЛржЯ) |
| **Stack Location** | OS managed memory | Heap (Go managed) |
| **рждрзИрж░рж┐ ржХрж░рж╛рж░ рж╕ржоржпрж╝** | ржзрзАрж░ (~1-2 ms) | ржжрзНрж░рзБржд (~1 ┬╡s) |
| **Context Switch** | ржзрзАрж░ (~1000 ns) | ржжрзНрж░рзБржд (~200 ns) |
| **Maximum рж╕ржВржЦрзНржпрж╛** | рж╣рж╛ржЬрж╛рж░ ржкрж░рзНржпржирзНржд | рж▓рж╛ржЦ/ржХрзЛржЯрж┐ ржкрж░рзНржпржирзНржд |
| **Scheduling** | OS Kernel ржХрж░рзЗ | Go Runtime ржХрж░рзЗ |
| **Memory Overhead** | ржкрзНрж░рждрж┐ржЯрж┐рждрзЗ 1-2 MB | ржкрзНрж░рждрж┐ржЯрж┐рждрзЗ 2 KB |
| **ржЙржжрж╛рж╣рж░ржг** | pthread, Windows thread | `go` keyword ржжрж┐ржпрж╝рзЗ |

### ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг:

#### OS Thread ржжрж┐ржпрж╝рзЗ:
```
1000 Thread рждрзИрж░рж┐ ржХрж░рж▓рзЗ:
1000 ├Ч 1 MB = 1000 MB = 1 GB RAM рж▓рж╛ржЧржмрзЗ!

ржПржмржВ:
- рждрзИрж░рж┐ ржХрж░рждрзЗ рж╕ржоржпрж╝ ржмрзЗрж╢рж┐
- Switch ржХрж░рждрзЗ рж╕ржоржпрж╝ ржмрзЗрж╢рж┐
- System slow рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ
```

#### Goroutine ржжрж┐ржпрж╝рзЗ:
```
1000 Goroutine рждрзИрж░рж┐ ржХрж░рж▓рзЗ:
1000 ├Ч 2 KB = 2000 KB = 2 MB RAM рж▓рж╛ржЧржмрзЗ!

ржПржмржВ:
- рждрзИрж░рж┐ ржХрж░рждрзЗ рж╕ржоржпрж╝ ржХржо
- Switch ржХрж░рждрзЗ рж╕ржоржпрж╝ ржХржо
- System smooth ржЪрж▓ржмрзЗ

ржПржоржиржХрж┐ 100,000 goroutine ржУ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржпрж╝!
```

---

## ЁЯМЯ ржмрж╛рж╕рзНрждржм ржЬрзАржмржирзЗрж░ ржЙржжрж╛рж╣рж░ржг

### ржЙржжрж╛рж╣рж░ржг рзз: Web Server

```go
// рззрзж,рзжрзжрзж user ржПржХрж╕рж╛ржерзЗ request ржкрж╛ржарж╛рж▓рзЛ
func handleRequest(userID int) {
    // Database query
    // Process data
    // Send response
    fmt.Println("Handling user:", userID)
}

func main() {
    // рззрзж,рзжрзжрзж goroutine рждрзИрж░рж┐ - ржХрзЛржи рж╕ржорж╕рзНржпрж╛ ржирзЗржЗ!
    for i := 1; i <= 10000; i++ {
        go handleRequest(i)
    }
    
    time.Sleep(10 * time.Second)
}

// Memory: 10,000 ├Ч 2KB = 20 MB (ржЦрзБржмржЗ ржХржо!)
```

### ржЙржжрж╛рж╣рж░ржг рзи: File Processing

```go
func processFile(filename string) {
    // Read file
    // Process data
    // Save result
    fmt.Println("Processing:", filename)
}

func main() {
    files := []string{"file1.txt", "file2.txt", "file3.txt", ...}
    
    // рж╕ржм file ржПржХрж╕рж╛ржерзЗ process ржХрж░рж╛
    for _, file := range files {
        go processFile(file)
    }
    
    time.Sleep(5 * time.Second)
}
```

### ржЙржжрж╛рж╣рж░ржг рзй: API Call ржХрж░рж╛

```go
func fetchData(apiURL string) {
    // HTTP request
    // Get response
    // Parse JSON
    fmt.Println("Data from:", apiURL)
}

func main() {
    apis := []string{
        "https://api1.com",
        "https://api2.com",
        "https://api3.com",
    }
    
    // рж╕ржм API ржПржХрж╕рж╛ржерзЗ call
    for _, api := range apis {
        go fetchData(api)
    }
    
    time.Sleep(3 * time.Second)
}
```

---

## ЁЯОУ ржорзВрж▓ рж╢рж┐ржХрзНрж╖рж╛ (Key Takeaways)

### рзз. Goroutine ржПрж░ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:
- тЬЕ ржЦрзБржмржЗ рж╣рж╛рж▓ржХрж╛ (2KB ржерзЗржХрзЗ рж╢рзБрж░рзБ)
- тЬЕ Heap ржП stack рж░рж╛ржЦрзЗ
- тЬЕ Dynamic grow/shrink ржХрж░рждрзЗ ржкрж╛рж░рзЗ
- тЬЕ Go Runtime manage ржХрж░рзЗ

### рзи. Memory Efficiency:
```
OS Thread:    1000 ├Ч 1 MB = 1 GB
Goroutine:    1000 ├Ч 2 KB = 2 MB

рж╕рж╛рж╢рзНрж░ржпрж╝: 500 ржЧрзБржг ржХржо memory!
```

### рзй. ржХржЦржи Goroutine ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи:
- тЬЕ Multiple task ржПржХрж╕рж╛ржерзЗ ржХрж░рждрзЗ рж╣ржмрзЗ
- тЬЕ Network request (API call, database query)
- тЬЕ File processing
- тЬЕ Real-time data processing
- тЬЕ Web server handling requests

### рзк. рж╕рждрж░рзНржХрждрж╛:
- тЪая╕П Main goroutine рж╢рзЗрж╖ рж╣рж▓рзЗ рж╕ржм goroutine ржмржирзНржз рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝
- тЪая╕П `time.Sleep()` ржмрж╛ `sync.WaitGroup` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
- тЪая╕П Goroutine ржЧрзБрж▓рзЛрж░ ржоржзрзНржпрзЗ data share ржХрж░рждрзЗ channel ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи

---

## ЁЯУК ржЪрж┐рждрзНрж░рзЗ рж╕рж╛рж░рж╛ржВрж╢

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ          ржЖржкржирж╛рж░ Go Program                       тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ                                                 тФВ
тФВ  main() {                                       тФВ
тФВ      go printHello(1)  тФАтФР                      тФВ
тФВ      go printHello(2)   тФЬтФАтЖТ 5ржЯрж┐ Goroutine     тФВ
тФВ      go printHello(3)   тФВ   рждрзИрж░рж┐ рж╣рж▓рзЛ          тФВ
тФВ      go printHello(4)   тФВ                      тФВ
тФВ      go printHello(5)  тФАтФШ                      тФВ
тФВ  }                                              тФВ
тФВ                                                 тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ            Go Runtime (mini OS)                 тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФВ
тФВ  тФВ  Scheduler: Goroutine ржЧрзБрж▓рзЛ distribute    тФВ  тФВ
тФВ  тФВ  Allocator: Heap ржП 2KB stack рждрзИрж░рж┐        тФВ  тФВ
тФВ  тФВ  GC: Unused memory clean                 тФВ  тФВ
тФВ  тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ  тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ               Heap Memory                       тФВ
тФВ  тФМтФАтФАтФАтФАтФмтФАтФАтФАтФАтФмтФАтФАтФАтФАтФмтФАтФАтФАтФАтФмтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР  тФВ
тФВ  тФВ 2KBтФВ2KB тФВ2KB тФВ2KB тФВ2KB тФВ   Free Space   тФВ  тФВ
тФВ  тФВ G1 тФВ G2 тФВ G3 тФВ G4 тФВ G5 тФВ                тФВ  тФВ
тФВ  тФФтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ  тФВ
тФВ                                                 тФВ
тФВ  Total: ржорж╛рждрзНрж░ 10 KB memory!                   тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## ЁЯТб рж╢рзЗрж╖ ржХржерж╛

**Goroutine рж╣рж▓рзЛ Go language ржПрж░ рж╕ржмржЪрзЗржпрж╝рзЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА feature!**

ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ ржжрзЗржпрж╝:
- ЁЯЪА High Performance
- ЁЯТ░ Low Memory Usage
- тЪб Fast Execution
- ЁЯОп Simple Syntax

**ржоржирзЗ рж░рж╛ржЦрзБржи:**
- ржкрзНрж░рждрж┐ржЯрж┐ goroutine = ржорж╛рждрзНрж░ 2KB (Heap ржП)
- Go Runtime рж╕ржм manage ржХрж░рзЗ
- рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ goroutine ржПржХрж╕рж╛ржерзЗ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржпрж╝
- ржПржЯрж╛ржЗ Go ржХрзЗ ржЕржирзНржпржжрзЗрж░ ржерзЗржХрзЗ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ!

---

## ЁЯУЭ ржЕржирзБрж╢рзАрж▓ржирзЗрж░ ржЬржирзНржп ржХрзЛржб

```go
package main

import (
    "fmt"
    "time"
)

// ржкрж░рзАржХрзНрж╖рж╛ рзз: ржПржХржЯрж╛ simple goroutine
func test1() {
    for i := 1; i <= 5; i++ {
        go func(n int) {
            fmt.Println("Goroutine", n)
        }(i)
    }
    time.Sleep(1 * time.Second)
}

// ржкрж░рзАржХрзНрж╖рж╛ рзи: ржЕржирзЗржХ goroutine
func test2() {
    for i := 1; i <= 1000; i++ {
        go func(n int) {
            fmt.Println("Processing", n)
        }(i)
    }
    time.Sleep(2 * time.Second)
}

// ржкрж░рзАржХрзНрж╖рж╛ рзй: nested function call
func innerFunc(x int) {
    fmt.Println("Inner:", x*2)
}

func outerFunc(x int) {
    fmt.Println("Outer:", x)
    innerFunc(x)
}

func test3() {
    for i := 1; i <= 5; i++ {
        go outerFunc(i)
    }
    time.Sleep(1 * time.Second)
}

func main() {
    fmt.Println("=== Test 1 ===")
    test1()
    
    fmt.Println("\n=== Test 2 ===")
    test2()
    
    fmt.Println("\n=== Test 3 ===")
    test3()
}
```
 