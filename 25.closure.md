# Go Closure тАУ Diagram + RAM / Stack / Heap ржмрзНржпрж╛ржЦрзНржпрж╛

---

## 1я╕ПтГг Closure ржХрзА? (ржПржХ рж▓рж╛ржЗржирзЗ)

Closure рж╣рж▓рзЛ ржПржоржи ржПржХржЯрж┐ function, ржпрж╛ рждрж╛рж░ outer function-ржПрж░ variable **ржоржирзЗ рж░рж╛ржЦрзЗ**, ржПржоржиржХрж┐ outer function рж╢рзЗрж╖ рж╣рзЯрзЗ ржЧрзЗрж▓рзЗржУред

ЁЯСЙ Function + Captured Variables = **Closure**

---

## 2я╕ПтГг ржЙржжрж╛рж╣рж░ржг ржХрзЛржб (Context)

```go
func outer() func() {
	money := 100
	myAge := 20
	fmt.Println("Age is :", myAge)

	show := func() {
		money = money + abc + amt
		fmt.Println("Money is :", money)
	}
	return show
}
```

---

## 3я╕ПтГг Program Memory Layout (High Level)

```
+---------------------+
|   Code Segment      |
|---------------------|
| abc (const = 10)    |
| function code       |
+---------------------+

+---------------------+
| Global Memory       |
|---------------------|
| amt = 50            |
+---------------------+

+---------------------+
| Stack               |
|---------------------|
| function calls      |
| local vars          |
+---------------------+

+---------------------+
| Heap                |
|---------------------|
| closure variables   |
+---------------------+
```

---

## 4я╕ПтГг Step-by-Step Execution with RAM / Stack / Heap

---

### ЁЯФ╣ Step 1: `main()` тЖТ `call()`

```
Stack:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ main()     тФВ
тФВ call()     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Heap: (empty)
```

---

### ЁЯФ╣ Step 2: `inner := outer()`

`outer()` call рж╣рж▓рзЗ:

* `money = 100`
* `myAge = 20`

```
Stack:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ main()     тФВ
тФВ call()     тФВ
тФВ outer()    тФВтФАтФА myAge = 20
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

ЁЯСЙ ржХрж┐ржирзНрждрзБ `show()` function `money` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ

тЪая╕П рждрж╛ржЗ `money` Stack-ржП рж░рж╛ржЦрж╛ ржпрж╛ржмрзЗ ржирж╛

---

### ЁЯФ╣ Step 3: Escape Analysis тЖТ money Heap-ржП ржЪрж▓рзЗ ржпрж╛рзЯ

```
Heap:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ money = 100      тФВ тЧАтФА closure reference
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Stack:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ main()     тФВ
тФВ call()     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

ЁЯСЙ `outer()` рж╢рзЗрж╖
ЁЯСЙ Stack ржерзЗржХрзЗ `outer()` ржЪрж▓рзЗ ржпрж╛рзЯ
ЁЯСЙ ржХрж┐ржирзНрждрзБ Heap-ржП `money` ржерзЗржХрзЗ ржпрж╛рзЯ

---

## 5я╕ПтГг Closure Call Animation

### ЁЯФБ First call: `inner()`

Calculation:

```
money = 100 + 10 + 50 = 160
```

```
Heap:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ money = 160      тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

### ЁЯФБ Second call: `inner()` ржЖржмрж╛рж░

```
money = 160 + 10 + 50 = 220
```

```
Heap:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ money = 220      тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

ЁЯСЙ **ржПржХржЗ Heap memory reuse рж╣ржЪрзНржЫрзЗ**

---

## 6я╕ПтГг ржжрзНржмрж┐рждрзАрзЯ Closure: `inner2 := outer()`

ржирждрзБржи `outer()` call ржорж╛ржирзЗ:

* ржирждрзБржи Heap memory
* ржкрзБрж░рзЛржирзЛ closure-ржПрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХ ржирзЗржЗ

```
Heap:
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ money = 220      тФВ тЧА inner
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ money = 100      тФВ тЧА inner2
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

---

## 7я╕ПтГг Garbage Collector (GC) ржХржЦржи ржХрж╛ржЬ ржХрж░ржмрзЗ?

```
inner = nil
inner2 = nil
```

ржпржЦржи:

* ржХрзЛржирзЛ closure ржЖрж░ `money` reference ржХрж░ржЫрзЗ ржирж╛
* Heap object unreachable рж╣рзЯрзЗ ржпрж╛рзЯ

ЁЯСЙ GC Heap ржерзЗржХрзЗ memory clean ржХрж░рзЗ

---

## 8я╕ПтГг Variable-wise Memory Summary

| Variable | ржХрзЛржерж╛рзЯ ржерж╛ржХрзЗ    | ржХрзЗржи                    |
| -------- | ------------- | ---------------------- |
| `abc`    | Code Segment  | constant               |
| `amt`    | Global Memory | global scope           |
| `myAge`  | Stack         | closure ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржирж╛ |
| `money`  | Heap          | closure capture ржХрж░рзЗржЫрзЗ  |

---

## 9я╕ПтГг Real-life Analogy (рж╕рж╣ржЬ)

```
outer()  = Bank Account
money   = Balance
inner() = Deposit Machine
```

* Account ржмржирзНржз рж╣рж▓рзЗржУ balance ржерж╛ржХрзЗ
* ржпрждржмрж╛рж░ deposit, balance ржмрж╛рзЬрзЗ
* ржирждрзБржи account = ржирждрзБржи balance

---

## ЁЯФЪ Final Takeaway

* Closure variable **ржоржирзЗ рж░рж╛ржЦрзЗ**
* Go рждрзЗ closure рж╣рж▓рзЗ variable Heap-ржП ржпрзЗрждрзЗ ржкрж╛рж░рзЗ
* ржПржХрж╛ржзрж┐ржХ closure тЗТ ржПржХрж╛ржзрж┐ржХ Heap memory
* GC ржкрж░рзЗ unused memory ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рзЗ

---

тЬЕ Closure ржмрзЛржЭрж╛рж░ ржЬржирзНржп Stack + Heap ржХрж▓рзНржкржирж╛ ржХрж░рж╛ржЗ рж╕ржмржЪрзЗрзЯрзЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржЙржкрж╛рзЯ
